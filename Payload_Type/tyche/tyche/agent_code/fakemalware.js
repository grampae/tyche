COMMANDS['fakemalware'] = async function(task) {
    var ads = [
        {bg: '#ff0000', title: 'âš ï¸ VIRUS DETECTED âš ï¸', body: 'Your computer has been infected with 47 viruses! Call 1-800-SCAM-NOW immediately!', btn: 'CLEAN NOW'},
        {bg: '#ff6600', title: 'ðŸŽ‰ CONGRATULATIONS! ðŸŽ‰', body: 'You are the 1,000,000th visitor! Click here to claim your FREE iPhone 47!', btn: 'CLAIM PRIZE'},
        {bg: '#cc00ff', title: 'ðŸ’‹ HOT SINGLES ðŸ’‹', body: 'Hot singles in ' + window.location.hostname + ' want to meet YOU tonight!', btn: 'MEET NOW'},
        {bg: '#00cc00', title: 'ðŸ’° MAKE $10,000/DAY ðŸ’°', body: 'This one weird trick discovered by a mom makes banks FURIOUS!', btn: 'GET RICH'},
        {bg: '#0066ff', title: 'ðŸ”’ SECURITY ALERT ðŸ”’', body: 'Your browser is critically outdated! Hackers can steal your data RIGHT NOW!', btn: 'UPDATE'},
        {bg: '#ff0066', title: 'ðŸŽ° YOU WON $1,000,000! ðŸŽ°', body: 'Enter your credit card to verify your identity and receive your winnings!', btn: 'COLLECT'},
        {bg: '#ffcc00', color: '#000', title: 'âš¡ PC RUNNING SLOW? âš¡', body: 'Download TurboClean Pro MAX Ultraâ„¢ to speed up your PC by 900%!', btn: 'DOWNLOAD'},
        {bg: '#00cccc', title: 'ðŸ‘ï¸ FBI WARNING ðŸ‘ï¸', body: 'Your browsing history has been recorded. Pay $500 in gift cards to avoid prosecution.', btn: 'PAY NOW'},
        {bg: '#ff3399', title: 'ðŸ’Š DOCTORS HATE HIM ðŸ’Š', body: 'Local man discovers one weird pill that does everything. Doctors are SHOOK!', btn: 'ORDER NOW'},
        {bg: '#333', title: 'â˜ ï¸ RANSOMWARE â˜ ï¸', body: 'All your files have been encrypted. Send 3 Bitcoin to recover them. Just kidding, this is a demo.', btn: 'PAY BTC'},
        {bg: '#ff4444', title: 'ðŸš¨ WINDOWS ALERT ðŸš¨', body: 'Windows has detected a critical error in sector 7G. Do NOT turn off your computer!', btn: 'FIX NOW'},
        {bg: '#9900ff', title: 'ðŸ¦  TROJAN DETECTED ðŸ¦ ', body: 'Trojan.GenericKD.46542789 found in system32. Your webcam may be compromised!', btn: 'REMOVE'}
    ];

    var popupCount = 0;
    var maxPopups = 30;
    var activePopups = [];

    function randomInt(min, max) {
        return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function spawnPopup() {
        if (popupCount >= maxPopups) return;
        popupCount++;

        var ad = ads[randomInt(0, ads.length - 1)];
        var w = randomInt(280, 420);
        var h = randomInt(180, 260);
        var x = randomInt(0, window.innerWidth - w);
        var y = randomInt(0, window.innerHeight - h);

        var popup = document.createElement('div');
        popup.style.cssText = 'position:fixed;z-index:' + (2147483600 + popupCount) +
            ';left:' + x + 'px;top:' + y + 'px;width:' + w + 'px;' +
            'background:' + ad.bg + ';color:' + (ad.color || '#fff') +
            ';border:3px solid #000;border-radius:8px;box-shadow:0 4px 20px rgba(0,0,0,0.5);' +
            'font-family:Arial,sans-serif;cursor:move;overflow:hidden;' +
            'animation:tyche-shake 0.3s ease-in-out;';

        // Title bar
        var titleBar = document.createElement('div');
        titleBar.style.cssText = 'background:rgba(0,0,0,0.3);padding:6px 10px;font-weight:bold;font-size:13px;display:flex;justify-content:space-between;align-items:center;';
        titleBar.innerHTML = '<span>' + ad.title + '</span>';

        var closeBtn = document.createElement('span');
        closeBtn.textContent = 'âœ•';
        closeBtn.style.cssText = 'cursor:pointer;font-size:16px;padding:0 4px;';
        closeBtn.onclick = function(e) {
            e.stopPropagation();
            // Closing spawns 2 more!
            spawnPopup();
            spawnPopup();
            popup.style.top = randomInt(0, window.innerHeight - h) + 'px';
            popup.style.left = randomInt(0, window.innerWidth - w) + 'px';
        };
        titleBar.appendChild(closeBtn);
        popup.appendChild(titleBar);

        // Body
        var body = document.createElement('div');
        body.style.cssText = 'padding:12px;font-size:14px;line-height:1.4;';
        body.textContent = ad.body;
        popup.appendChild(body);

        // Button
        var btn = document.createElement('div');
        btn.style.cssText = 'margin:8px 12px 12px;padding:8px;background:rgba(0,0,0,0.3);' +
            'text-align:center;border-radius:4px;font-weight:bold;font-size:15px;cursor:pointer;' +
            'border:2px solid rgba(255,255,255,0.5);';
        btn.textContent = ad.btn;
        btn.onmouseover = function() { btn.style.transform = 'scale(1.05)'; };
        btn.onmouseout = function() { btn.style.transform = 'scale(1)'; };
        btn.onclick = function(e) {
            e.stopPropagation();
            spawnPopup();
            spawnPopup();
            spawnPopup();
        };
        popup.appendChild(btn);

        // Make draggable
        var drag = false, dx = 0, dy = 0;
        titleBar.onmousedown = function(e) {
            drag = true;
            dx = e.clientX - popup.offsetLeft;
            dy = e.clientY - popup.offsetTop;
            e.preventDefault();
        };
        document.addEventListener('mousemove', function(e) {
            if (!drag) return;
            popup.style.left = (e.clientX - dx) + 'px';
            popup.style.top = (e.clientY - dy) + 'px';
        });
        document.addEventListener('mouseup', function() { drag = false; });

        document.body.appendChild(popup);
        activePopups.push(popup);

        // Random drift for some popups
        if (Math.random() > 0.5) {
            var vx = (Math.random() - 0.5) * 4;
            var vy = (Math.random() - 0.5) * 4;
            var drift = setInterval(function() {
                if (!document.body.contains(popup)) { clearInterval(drift); return; }
                var cx = popup.offsetLeft + vx;
                var cy = popup.offsetTop + vy;
                if (cx < 0 || cx > window.innerWidth - w) vx = -vx;
                if (cy < 0 || cy > window.innerHeight - h) vy = -vy;
                popup.style.left = cx + 'px';
                popup.style.top = cy + 'px';
            }, 30);
        }
    }

    // Inject keyframe animation
    var style = document.createElement('style');
    style.textContent = '@keyframes tyche-shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}50%{transform:translateX(5px)}75%{transform:translateX(-3px)}}';
    document.head.appendChild(style);

    // Rapid-fire spawn
    for (var i = 0; i < 8; i++) {
        spawnPopup();
    }

    // Keep spawning on a timer
    var spawner = setInterval(function() {
        if (popupCount >= maxPopups) { clearInterval(spawner); return; }
        spawnPopup();
    }, 800);

    // Cursor trail for extra chaos
    var trail = [];
    document.addEventListener('mousemove', function trailFn(e) {
        if (popupCount >= maxPopups && trail.length > 20) {
            document.removeEventListener('mousemove', trailFn);
            return;
        }
        var dot = document.createElement('div');
        dot.style.cssText = 'position:fixed;z-index:2147483646;pointer-events:none;' +
            'left:' + e.clientX + 'px;top:' + e.clientY + 'px;' +
            'width:10px;height:10px;border-radius:50%;' +
            'background:hsl(' + (Date.now() % 360) + ',100%,50%);' +
            'transition:all 0.5s ease-out;opacity:1;';
        document.body.appendChild(dot);
        trail.push(dot);
        setTimeout(function() {
            dot.style.opacity = '0';
            dot.style.transform = 'scale(3)';
        }, 50);
        setTimeout(function() {
            if (dot.parentNode) dot.parentNode.removeChild(dot);
            trail.shift();
        }, 600);
    });

    return 'Unleashed ' + maxPopups + ' popups. Close buttons spawn more. Good luck.';
};
